<div class="row">
    <nav class="navbar navbar-default">
        <div class="container">
            <h1 class="text-center text-capitalize">Room {{ id }}</h1>
        </div>
        <!--<a class="text-right" href="/"><span class="glyphicon glyphicon-remove-sign"></span> Leave</a>-->
    </nav>

    <div class="row" id="player-list"></div>
</div>
<script>

    var socket = io();
    var room = '{{ id }}';
    socket.on('connect', function(){
        var socketId = socket.id;
        socket.emit('join', {roomId: room, socketId: socketId});
    });

    var updateView = function(players){
        console.log(players);
        var playerHtml = '';

        for(var i = 0; i <= players.length - 1; i++){
            var readyClass = players[i]['ready'] == 0? 'text-danger':'text-success';
            var readyText = players[i]['ready'] == 0? 'Not Ready':'Ready';
            var readyButton = (i == 0)?'<button class="btn btn-info ready-button" data-id=' + players[i]['id'] + '>Ready</button>': '';
            var selfClass = (i == 0)?'col-xs-6 col-xs-offset-3': 'col-xs-6';
            playerHtml +=
                    '<div class="'+ selfClass +'">'
                    + '<div class="panel panel-default">'
                    + '<div class="panel-heading text-center">' + players[i]['nick_name'] +'</div>'
                    + '<div class="panel-body text-center">'
                    + '<div class="' + readyClass +' ready-status">' + readyText + '</div>'
                    + '<img src="/content/img/user_1.png" class="img-circle img-responsive center-block" style="width: 100px;">'
                    + '<div>'
                    + readyButton
                    + '</div>'
                    + '</div>'
                    + '</div>'
                    + '</div>';
        }

        if(playerHtml){
            $("#player-list").empty().html(playerHtml);
        }
    };

    updateView({{{json players}}});

    socket.on('updatePlayers', function(data){
        console.log(data);
        var selfObj = data['self'];
        var othersObjs = data['others'];
        othersObjs.unshift(selfObj);
        console.log(othersObjs);

        updateView(othersObjs);
    });

</script>